<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="icon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beep Clicker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #1a1a1a;
            color: #fef3c7;
            user-select: none;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #27272a; }
        ::-webkit-scrollbar-thumb { background: #d97706; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #f59e0b; }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }

        @keyframes orbit {
            from { transform: rotate(0deg) translateX(120px) rotate(0deg); }
            to   { transform: rotate(360deg) translateX(120px) rotate(-360deg); }
        }

        .click-effect {
            position: absolute;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 50;
        }

        .click-target {
            transition: transform 0.05s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            filter: drop-shadow(0_0_15px_rgba(245,158,11,0.3));
        }
        
        .click-target:active { transform: scale(0.92); }

        .orbit-container {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 0; 
        }

        .glass-panel {
            background: rgba(30, 30, 35, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(251, 191, 36, 0.1);
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col md:flex-row relative">

    <!-- Assets (Easily Editable) -->
    <audio id="bgm" src="bgmbeepclicker.mp3" loop></audio>

    <!-- Welcome Back Modal -->
    <div id="offline-modal" class="hidden absolute inset-0 z-[110] bg-black/90 flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-sm rounded-2xl p-8 text-center border border-amber-500/50 shadow-2xl">
            <h2 class="text-3xl font-black text-amber-400 mb-2 uppercase tracking-tight">Welcome Back!</h2>
            <p class="text-gray-400 text-sm mb-6 uppercase font-bold tracking-widest">While you were away, you earned:</p>
            <div class="text-5xl font-black text-amber-300 mb-8 drop-shadow-md">
                +<span id="offline-amount">0</span>
            </div>
            <button onclick="closeOfflineModal()" class="w-full py-4 bg-amber-600 hover:bg-amber-500 text-white font-black rounded-xl transition-all uppercase tracking-widest shadow-lg">
                Collect Beeps
            </button>
        </div>
    </div>

    <!-- Achievement Modal -->
    <div id="ach-modal" class="hidden absolute inset-0 z-[100] bg-black/80 flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-lg rounded-2xl p-6 relative shadow-2xl border border-amber-500/30">
            <button onclick="toggleAchievements()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-xl">‚úï</button>
            <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center tracking-tight">Achievements</h2>
            <div id="ach-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2"></div>
        </div>
    </div>

    <!-- Main Game View -->
    <div class="relative flex-1 flex flex-col items-center justify-center p-6 overflow-hidden bg-gradient-to-br from-gray-900 to-gray-800">
        
        <!-- Navigation Buttons -->
        <div class="absolute top-4 left-4 flex gap-3 z-50">
            <a href="https://beepsmol.com/projects" class="p-3 bg-gray-800/80 hover:bg-gray-700 rounded-full border border-amber-900/50 text-xl transition-all shadow-lg flex items-center justify-center" title="Back to Projects">
                ‚¨ÖÔ∏è
            </a>
            <button id="mute-btn" onclick="toggleMute()" class="p-3 bg-gray-800/80 hover:bg-gray-700 rounded-full border border-amber-900/50 text-xl transition-all shadow-lg">
                üîá
            </button>
        </div>

        <div class="z-10 text-center mb-6">
            <h1 class="text-xl md:text-2xl text-amber-500 font-bold opacity-80 uppercase tracking-widest">Beeps</h1>
            <div class="text-5xl md:text-7xl font-black text-amber-300 drop-shadow-lg tracking-tight">
                <span id="score">0</span>
            </div>
            <div class="text-sm text-amber-600 mt-2 font-bold uppercase tracking-tighter">
                <span id="sps">0</span> per second
            </div>
        </div>

        <div class="z-10 w-64 mb-8">
            <div class="flex justify-between text-[10px] font-black uppercase tracking-widest mb-1">
                <span class="text-amber-600">Multiplier Limit: <span id="limit-text">2.0x</span></span>
                <span id="combo-text" class="text-amber-400">1.0x</span>
            </div>
            <div class="h-3 w-full bg-gray-900 rounded-full border border-gray-700/50 overflow-hidden relative">
                <div id="combo-bar" class="h-full bg-gradient-to-r from-amber-700 via-orange-500 to-yellow-400 w-0 transition-all duration-100 ease-linear shadow-[0_0_15px_rgba(245,158,11,0.5)]"></div>
            </div>
            <p class="text-[10px] text-gray-500 text-center mt-1 h-4 font-bold uppercase tracking-widest" id="combo-decay-msg">Keep clicking!</p>
        </div>

        <div class="relative w-64 h-64 flex items-center justify-center">
            <div id="orbit-area" class="orbit-container"></div>
            <div id="click-btn" class="relative z-20 click-target rounded-full w-48 h-48 flex items-center justify-center bg-gray-800 border-4 border-amber-900/30">
                <img id="main-img" src="clickitem.png" alt="Click Item" class="w-full h-full object-contain p-2 rounded-full hidden" onerror="handleImgError(this)">
                <div id="fallback-img" class="text-8xl select-none">üêù</div>
            </div>
        </div>

        <div id="particles" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        <div id="notification-area" class="absolute top-4 right-4 z-50 flex flex-col gap-2 pointer-events-none"></div>
    </div>

    <!-- Shop -->
    <div class="w-full md:w-[400px] h-1/2 md:h-full glass-panel flex flex-col border-t md:border-t-0 md:border-l border-amber-900/30">
        <div class="p-6 bg-gray-900/50 border-b border-amber-900/20 flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-black text-amber-400 uppercase tracking-tighter">Upgrades</h2>
                <p class="text-xs text-amber-600/80 font-bold uppercase tracking-widest">Better Beeps</p>
            </div>
            <button onclick="toggleAchievements()" class="p-3 bg-gray-800 hover:bg-gray-700 rounded-xl border border-amber-900/50 text-xl transition-all shadow-md active:scale-90" title="Achievements">
                üèÜ
            </button>
        </div>
        <div id="shop-container" class="flex-1 overflow-y-auto p-4 space-y-3 pb-24"></div>
    </div>

    <script>
        const state = {
            score: 0,
            clickPower: 1,
            autoPower: 0,
            totalClicks: 0,
            comboCount: 0,
            comboMultiplier: 1.0,
            comboDecayTimer: 0,
            currentMaxMult: 2.0, // Initial limit
            isMuted: true,
            lastSave: Date.now()
        };

        const upgrades = [
            { id: 'click_1', name: 'Beepier Beeps', description: 'Makes clicking +1 stronger.', type: 'click', baseCost: 15, count: 0, power: 1, costMult: 1.5 },
            { id: 'auto_1', name: 'Auto Beeping', description: 'Automatically generates 2 per second.', type: 'auto', baseCost: 50, count: 0, power: 2, costMult: 1.4 },
            { id: 'visual_1', name: 'Beep Helpers', description: 'Spawns a Beep to help Beep. (+5/sec)', type: 'visual_mouse', baseCost: 250, count: 0, power: 5, costMult: 1.6 },
            { id: 'limit_1', name: 'Multiplier Increase', description: 'Increases Multiplier Limit by +1x (Max 25x).', type: 'limit', baseCost: 1000, count: 0, power: 1, costMult: 2.5 },
            { id: 'click_2', name: 'Beepiest Beeps', description: 'Click power increased by +10.', type: 'click', baseCost: 500, count: 0, power: 10, costMult: 1.5 },
            { id: 'auto_2', name: 'Beeping Machine', description: 'Generates +25 per second.', type: 'auto', baseCost: 1200, count: 0, power: 25, costMult: 1.4 },
            { id: 'visual_2', name: 'Beepier Beep Helpers', description: 'More Beeps. (+40/sec)', type: 'visual_mouse', baseCost: 5000, count: 0, power: 40, costMult: 1.6 }
        ];

        const achievements = [
            { id: 'ach_1', name: 'Hardworking Beep', desc: 'Click 100 times manually.', unlocked: false, check: (s) => s.totalClicks >= 100 },
            { id: 'ach_2', name: 'Gatherer', desc: 'Reach 1,000 Beeps.', unlocked: false, check: (s) => s.score >= 1000 },
            { id: 'ach_3', name: 'Combo Novice', desc: 'Reach a 2x Combo Multiplier.', unlocked: false, check: (s) => s.comboMultiplier >= 2.0 },
            { id: 'ach_4', name: 'Limit Breaker', desc: 'Increase multiplier limit.', unlocked: false, check: (s) => s.currentMaxMult > 2.0 },
            { id: 'ach_5', name: 'Sun God', desc: 'Reach 100,000 Beeps.', unlocked: false, check: (s) => s.score >= 100000 }
        ];

        // --- Selectors ---
        const bgm = document.getElementById('bgm');
        const muteBtn = document.getElementById('mute-btn');
        const scoreEl = document.getElementById('score');
        const spsEl = document.getElementById('sps');
        const clickBtn = document.getElementById('click-btn');
        const shopContainer = document.getElementById('shop-container');
        const orbitArea = document.getElementById('orbit-area');
        const particleContainer = document.getElementById('particles');
        const comboText = document.getElementById('combo-text');
        const limitText = document.getElementById('limit-text');
        const comboBar = document.getElementById('combo-bar');
        const comboMsg = document.getElementById('combo-decay-msg');
        const mainImg = document.getElementById('main-img');
        const fallbackImg = document.getElementById('fallback-img');

        // --- Save / Load & Offline ---
        function saveGame() {
            state.lastSave = Date.now();
            localStorage.setItem('cozyClickerSave', JSON.stringify({
                state,
                upgrades: upgrades.map(u => ({ id: u.id, count: u.count }))
            }));
        }

        function loadGame() {
            const saved = localStorage.getItem('cozyClickerSave');
            if (saved) {
                const data = JSON.parse(saved);
                Object.assign(state, data.state);
                data.upgrades.forEach(savedU => {
                    const u = upgrades.find(item => item.id === savedU.id);
                    if (u) {
                        u.count = savedU.count;
                        if (u.type === 'click') state.clickPower += (u.power * u.count);
                        if (u.type === 'auto' || u.type === 'visual_mouse') state.autoPower += (u.power * u.count);
                        if (u.type === 'limit') state.currentMaxMult += (u.power * u.count);
                        if (u.type === 'visual_mouse') {
                            for(let i=0; i<u.count; i++) addVisualMouse();
                        }
                    }
                });

                const now = Date.now();
                const diff = (now - state.lastSave) / 1000; // seconds
                if (diff > 10 && state.autoPower > 0) {
                    const earned = Math.floor(state.autoPower * diff);
                    state.score += earned;
                    document.getElementById('offline-amount').innerText = earned.toLocaleString();
                    document.getElementById('offline-modal').classList.remove('hidden');
                }
            }
        }

        function closeOfflineModal() {
            document.getElementById('offline-modal').classList.add('hidden');
        }

        function toggleMute() {
            state.isMuted = !state.isMuted;
            if (state.isMuted) { bgm.pause(); muteBtn.innerText = 'üîá'; }
            else { bgm.play().catch(() => flashMessage("Tap to start music!")); muteBtn.innerText = 'üîä'; }
        }

        mainImg.onload = () => { mainImg.classList.remove('hidden'); fallbackImg.classList.add('hidden'); };
        window.handleImgError = (img) => { img.classList.add('hidden'); fallbackImg.classList.remove('hidden'); };

        function updateUI() {
            scoreEl.innerText = Math.floor(state.score).toLocaleString();
            spsEl.innerText = state.autoPower.toLocaleString();
            limitText.innerText = state.currentMaxMult.toFixed(1) + 'x';
            
            upgrades.forEach(u => {
                const btn = document.getElementById(`btn-${u.id}`);
                const costEl = document.getElementById(`cost-${u.id}`);
                const countEl = document.getElementById(`count-${u.id}`);
                const currentCost = Math.floor(u.baseCost * Math.pow(u.costMult, u.count));
                
                if (btn) {
                    costEl.innerText = currentCost.toLocaleString();
                    countEl.innerText = u.count;
                    const isMaxLimit = u.type === 'limit' && state.currentMaxMult >= 25;
                    
                    if (state.score >= currentCost && !isMaxLimit) {
                        btn.classList.remove('opacity-50', 'grayscale');
                        btn.classList.add('hover:bg-gray-800', 'border-amber-500/40');
                    } else {
                        btn.classList.add('opacity-50', 'grayscale');
                        btn.classList.remove('hover:bg-gray-800', 'border-amber-500/40');
                    }
                    if (isMaxLimit) {
                        costEl.innerText = "MAX";
                        btn.classList.add('pointer-events-none');
                    }
                }
            });

            comboText.innerText = state.comboMultiplier.toFixed(1) + 'x';
            // Progress bar mapping combo points (0 to 20xPointsPerLimit)
            const progress = ((state.comboMultiplier - 1) / (state.currentMaxMult - 1)) * 100;
            comboBar.style.width = `${Math.min(100, progress)}%`;
        }

        function createShop() {
            shopContainer.innerHTML = '';
            upgrades.forEach(u => {
                const item = document.createElement('div');
                item.id = `btn-${u.id}`;
                item.className = `group p-4 rounded-2xl bg-gray-900 border border-amber-900/30 flex items-center gap-4 transition-all duration-200 select-none cursor-pointer`;
                item.innerHTML = `
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <h3 class="font-black text-amber-200 uppercase tracking-tight">${u.name}</h3>
                            <span class="text-[10px] font-black bg-amber-900/40 text-amber-500 px-2 py-0.5 rounded-md">Lvl <span id="count-${u.id}">0</span></span>
                        </div>
                        <p class="text-xs text-gray-400 leading-tight mb-2">${u.description}</p>
                        <div class="text-sm font-black text-amber-500 flex items-center gap-1">
                            ü™ô <span id="cost-${u.id}">0</span>
                        </div>
                    </div>
                `;
                item.onclick = () => buyUpgrade(u);
                shopContainer.appendChild(item);
            });
        }

        function buyUpgrade(upgrade) {
            const currentCost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMult, upgrade.count));
            if (upgrade.type === 'limit' && state.currentMaxMult >= 25) return;
            
            if (state.score >= currentCost) {
                state.score -= currentCost;
                upgrade.count++;
                if (upgrade.type === 'click') state.clickPower += upgrade.power;
                else if (upgrade.type === 'auto' || upgrade.type === 'visual_mouse') state.autoPower += upgrade.power;
                else if (upgrade.type === 'limit') state.currentMaxMult += upgrade.power;
                
                if (upgrade.type === 'visual_mouse') addVisualMouse();
                updateUI();
                flashMessage(`${upgrade.name} UP!`);
                saveGame();
            }
        }

        function addVisualMouse() {
            const wrapper = document.createElement('div');
            wrapper.className = 'absolute top-0 left-0 w-full h-full';
            wrapper.style.animation = `orbit ${4 + Math.random() * 4}s linear infinite`;
            const mouse = document.createElement('div');
            mouse.className = 'absolute flex items-center justify-center';
            const mouseImg = document.createElement('img');
            mouseImg.src = 'mouse.png';
            mouseImg.className = 'w-6 h-6 object-contain drop-shadow-[0_0_8px_rgba(251,191,36,0.6)]';
            mouseImg.onerror = function() { this.remove(); mouse.innerText = 'üñ±Ô∏è'; mouse.className += ' text-2xl text-amber-400'; };
            mouse.appendChild(mouseImg);
            wrapper.style.transform = `rotate(${Math.random() * 360}deg)`;
            mouse.style.transform = `translateX(${110 + (Math.random() * 30)}px) rotate(-90deg)`;
            wrapper.appendChild(mouse);
            orbitArea.appendChild(wrapper);
        }

        function spawnFloatingText(x, y, amount) {
            const el = document.createElement('div');
            el.className = 'click-effect text-2xl font-black text-amber-300';
            el.innerHTML = `+${Math.floor(amount)} ${state.comboMultiplier > 1.2 ? `<br><span class="text-xs text-orange-400">${state.comboMultiplier.toFixed(1)}x</span>` : ''}`;
            el.style.left = `${x}px`; el.style.top = `${y}px`;
            particleContainer.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function flashMessage(msg) {
            const el = document.createElement('div');
            el.className = 'bg-gray-800 text-amber-400 text-xs font-black uppercase tracking-widest px-4 py-2 rounded-full border border-amber-500/50 shadow-2xl animate-[floatUp_2s_ease-out_forwards]';
            el.innerText = msg;
            document.getElementById('notification-area').appendChild(el);
            setTimeout(() => el.remove(), 2000);
        }

        function toggleAchievements() {
            const modal = document.getElementById('ach-modal');
            const list = document.getElementById('ach-list');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                list.innerHTML = '';
                achievements.forEach(ach => {
                    const el = document.createElement('div');
                    el.className = `p-4 rounded-2xl border transition-all ${ach.unlocked ? 'bg-amber-900/10 border-amber-500/40' : 'bg-gray-900/50 border-gray-800 opacity-40'} flex items-center gap-4`;
                    el.innerHTML = `<div class="text-3xl">${ach.unlocked ? 'üèÜ' : 'üîí'}</div><div><h4 class="font-black text-amber-200 uppercase tracking-tighter">${ach.name}</h4><p class="text-xs text-gray-500 font-bold uppercase">${ach.desc}</p></div>`;
                    list.appendChild(el);
                });
            } else modal.classList.add('hidden');
        }

        function checkAchievements() {
            achievements.forEach(ach => {
                if (!ach.unlocked && ach.check(state)) {
                    ach.unlocked = true;
                    flashMessage(`üèÜ ${ach.name}`);
                }
            });
        }

        function handleClick(e) {
            state.totalClicks++;
            // Combo points logic: 20 clicks to gain 1.0x mult
            state.comboCount = Math.min((state.currentMaxMult - 1) * 20, state.comboCount + 1);
            state.comboDecayTimer = 1500;
            const amount = state.clickPower * state.comboMultiplier;
            state.score += amount;
            const x = e.clientX || (clickBtn.getBoundingClientRect().left + 96);
            const y = e.clientY || (clickBtn.getBoundingClientRect().top + 96);
            spawnFloatingText(x, y, amount);
            updateUI();
        }

        clickBtn.addEventListener('mousedown', handleClick);
        clickBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            [...e.changedTouches].forEach(t => {
                state.totalClicks++;
                state.comboCount = Math.min((state.currentMaxMult - 1) * 20, state.comboCount + 1);
                state.comboDecayTimer = 1500;
                const amount = state.clickPower * state.comboMultiplier;
                state.score += amount;
                spawnFloatingText(t.clientX, t.clientY, amount);
            });
            updateUI();
        });

        // --- Loops ---
        setInterval(() => {
            if (state.autoPower > 0) state.score += state.autoPower / 10;
            if (state.comboDecayTimer > 0) state.comboDecayTimer -= 100;
            else if (state.comboCount > 0) state.comboCount = Math.max(0, state.comboCount - 0.5);
            
            // Re-calc multiplier
            state.comboMultiplier = 1 + (state.comboCount * 0.05);
            
            checkAchievements();
            updateUI();

            if (state.comboDecayTimer <= 0 && state.comboCount > 0) comboMsg.innerText = "Decaying...";
            else if (state.comboCount === 0) comboMsg.innerText = "Start clicking!";
            else if (state.comboMultiplier >= state.currentMaxMult) comboMsg.innerText = "MAX POWER!";
            else comboMsg.innerText = "On Fire!";
        }, 100);

        setInterval(saveGame, 10000); // Auto-save every 10s

        // --- Init ---
        createShop();
        loadGame();
        updateUI();
    </script>
</body>

</html>
