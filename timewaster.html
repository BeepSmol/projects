<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="icon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Time Waster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* LOW EFFORT UI THEME */
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #000000;
            color: #ffffff;
            overflow-x: hidden;
            user-select: none;
        }

        /* Brutalist Box Style */
        .box {
            border: 2px solid #ffffff;
            background: #000000;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .btn {
            background: #000000;
            border: 2px solid #ffffff;
            color: #ffffff;
            font-weight: bold;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.1s;
        }
        .btn:hover:not(:disabled) {
            background: #ffffff;
            color: #000000;
        }
        .btn:active:not(:disabled) {
            transform: translate(2px, 2px);
        }
        .btn:disabled {
            border-color: #555;
            color: #555;
            cursor: not-allowed;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #000; border-left: 2px solid #fff; }
        ::-webkit-scrollbar-thumb { background: #fff; }

        /* Bouncing Box Canvas */
        #boredomCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0;
        }
        
        .content-layer {
            position: relative;
            z-index: 10;
        }

        /* Golden Second Animation */
        .golden-second {
            position: fixed;
            font-size: 2rem;
            color: #ffd700;
            cursor: pointer;
            user-select: none;
            animation: floatUp 4s linear forwards;
            z-index: 50;
            transition: transform 0.2s, opacity 0.2s;
        }
        .golden-second.captured {
            color: #00ff00;
            transform: scale(1.5) !important;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff00;
            pointer-events: none;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        .chat-msg {
            margin-bottom: 4px;
            padding: 4px;
            border-left: 2px solid #333;
        }

        /* Bubble Wrap */
        .bubble {
            width: 30px; height: 30px;
            border-radius: 50%;
            border: 2px solid #555;
            cursor: pointer;
            background: #222;
        }
        .bubble.popped {
            background: transparent;
            border-color: #333;
            transform: scale(0.9);
        }

        /* Drawing Canvas */
        #drawCanvas {
            border: 1px dashed #666;
            cursor: crosshair;
            background: #111;
            touch-action: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

  <div id="startOverlay" class="fixed inset-0 z-[100] bg-black flex items-center justify-center cursor-pointer">
    <div class="text-2xl border-2 border-white p-8 hover:bg-white hover:text-black">
        CLICK TO START WASTING TIME
    </div>
  </div>
    <!-- Assets -->
    <audio id="bgMusic" loop src="timewasted.mp3"></audio>
    <canvas id="boredomCanvas"></canvas>

    <!-- Desktop Sidebars (Visible on XL screens) -->
    <div id="desktopSidebarLeft" class="hidden xl:flex fixed left-4 top-24 bottom-4 w-56 flex-col gap-2 overflow-y-auto z-20 opacity-50 pointer-events-none transition-opacity">
        <div class="text-xs font-bold border-b border-white mb-2 pb-1">BOREDOM ZONE (L)</div>
        <!-- Content injected by JS -->
    </div>
    <div id="desktopSidebarRight" class="hidden xl:flex fixed right-4 top-24 bottom-4 w-56 flex-col gap-2 overflow-y-auto z-20 opacity-50 pointer-events-none transition-opacity">
        <div class="text-xs font-bold border-b border-white mb-2 pb-1">BOREDOM ZONE (R)</div>
        <!-- Content injected by JS -->
    </div>

    <div class="content-layer w-full max-w-3xl z-10">
        
        <!-- Header -->
        <header class="text-center mb-8 border-b-2 border-white pb-4">
            <h1 class="text-4xl font-bold uppercase tracking-tighter">THE TIME WASTER</h1>
            <div class="text-xs mt-2" id="rankTitle">RANK: NOVICE</div>
            
            <div class="flex justify-center gap-4 mt-4">
                <button onclick="toggleMusic()" class="btn text-xs">[TOGGLE MUSIC]</button>
                <button onclick="triggerReset()" class="btn text-xs hover:bg-red-600 hover:text-white border-red-500 text-red-500">[HARD RESET]</button>
            </div>
            
            <div id="offlineBadge" class="hidden mt-4 border border-green-500 text-green-500 p-2 text-xs">
                OFFLINE PROGRESS: GAINED <span id="offlineGain">0</span> SECONDS
            </div>
        </header>

        <!-- Stats Block -->
        <div class="box flex flex-col items-center">
            
            <!-- TOTALS COUNTERS -->
            <div class="grid grid-cols-2 w-full gap-4 text-center mb-4 border-b border-gray-700 pb-4">
                <div>
                    <div class="text-xs text-purple-400 font-bold">LIFETIME</div>
                    <div class="text-xl font-bold text-purple-300" id="chronoTotalDisplay">0.0</div>
                </div>
                <div>
                    <div class="text-xs text-blue-400 font-bold">TOTAL (THIS RUN)</div>
                    <div class="text-xl font-bold text-blue-300" id="runTotalDisplay">0.0</div>
                </div>
            </div>

            <!-- MAIN STATS ROW -->
            <div class="grid grid-cols-3 w-full gap-2 text-center mb-6 items-center">
                <div class="col-span-1">
                    <div class="text-xs text-gray-500">TIME WASTED</div>
                    <div class="text-3xl font-bold" id="secondsDisplay">0.0</div>
                    <div class="text-xs" id="rateDisplay">+0.0/s</div>
                </div>
                
                <!-- CHRONOTONS (Hidden until prestige) -->
                <div id="chronoColumn" class="col-span-1 border-x border-gray-800 hidden">
                    <div class="text-xs text-purple-400">CHRONOTONS</div>
                    <div class="text-3xl font-bold text-purple-400" id="chronotonDisplay">0</div>
                    <div class="text-[10px] text-purple-300" id="chronoMultDisplay">+0% BONUS</div>
                </div>

                <!-- Spacer if chrono hidden -->
                <div id="chronoSpacer" class="col-span-1 border-x border-gray-800 flex items-center justify-center">
                    <div class="text-xs text-gray-700">LOCKED</div>
                </div>

                <div class="col-span-1">
                    <div class="text-xs text-gray-500">CLOCKS</div>
                    <div class="text-3xl font-bold text-yellow-300" id="clocksDisplay">0</div>
                    <div class="text-xs">CURRENCY</div>
                </div>
            </div>

            <button id="convertBtn" class="btn w-full py-4 text-lg border-dashed">
                CONVERT <span id="convertCost">100</span>s -> 1 CLOCK
            </button>
            <div id="convertMsg" class="h-4 text-xs text-red-500 mt-2 text-center opacity-0">INSUFFICIENT FUNDS</div>
        </div>

        <!-- Prestige Block -->
        <div id="prestigeSection" class="hidden box border-purple-500 text-center">
            <h3 class="text-purple-400 font-bold mb-2">THE CHRONOTON TIME MACHINE</h3>
            <p class="text-xs mb-4">
                The machine hums with energy. Reset your run to acquire Chronotons.
                <br>REQ: <span id="nextChronoReq">25,000</span> LIFETIME SECONDS.
                <br>EFFECT: +100x SPEED PER CHRONOTON.
            </p>
            <div id="potentialChrono" class="text-lg mb-4 text-white">REWARD: 0 CHRONOTONS</div>
            <button onclick="prestige()" class="btn w-full border-purple-500 text-purple-400 hover:bg-purple-900">
                [ACTIVATE TIME MACHINE]
            </button>
        </div>

        <!-- Layout Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            
            <!-- Shop -->
            <div>
                <h2 class="font-bold border-b-2 border-white mb-2">SHOP</h2>
                <div id="shopGrid" class="space-y-2"></div>
            </div>

            <!-- Boredom Zone -->
            <div id="boredomSection" class="opacity-50 pointer-events-none transition-opacity">
                <!-- Mobile Title -->
                <h2 class="font-bold border-b-2 border-white mb-2 xl:hidden">BOREDOM ZONE</h2>
                <!-- Mobile Grid (Hidden on XL) -->
                <div id="distractionGrid" class="grid grid-cols-2 gap-2 xl:hidden"></div>
                
                <!-- Active Minigame Area (Always Center) -->
                <div id="activeMinigame" class="mt-4 empty:hidden box border-dashed"></div>
            </div>
        </div>

        <!-- Log -->
        <div class="box mt-4 h-32 overflow-y-auto text-xs font-mono text-gray-400" id="gameLog">
            <div>> SYSTEM_READY...</div>
        </div>

    </div>

    <script>
        // --- Configuration ---
        const CONFIG = {
            BASE_CONVERSION: 100,
            CONVERSION_SCALE: 1.01,
            OFFLINE_RATE: 5, 
            CHRONO_THRESHOLD: 25000,
            CHRONO_SCALE: 100, // Multiplier for next chronoton cost
            SAVE_KEY: 'timeWaster_v3_boredom'
        };

        const assets = {
            dvd: new Image(),
            music: document.getElementById('bgMusic')
        };
        assets.dvd.src = 'dvdlogo.png';
        assets.music.play();
        
        // --- State ---
        let state = {
            seconds: 0,
            clocks: 0,
            multiplier: 1,
            chronotons: 0,
            prestigeCount: 0,
            totalSecondsWasted: 0, 
            runSecondsWasted: 0,   
            conversions: 0, 
            lastSaveTime: Date.now(),
            shopCounts: {
                gears: 0,
                chrono: 0,
                machine: 0
            },
            unlocks: {
                bg: false,
                dvd: false,
                chat: false,
                rock: false,
                bubble: false,
                draw: false
            }
        };

        // --- Data ---
        const RANKS = [
            { t: 0, title: "NOVICE" },
            { t: 60, title: "WASTER" },
            { t: 300, title: "IDLER" },
            { t: 1000, title: "SLACKER" },
            { t: 3600, title: "PROCRASTINATOR" },
            { t: 25000, title: "CHRONO-SCOUT" },
            { t: 86400, title: "TIME BANDIT" },
            { t: 1000000, title: "ENTROPY GOD" }
        ];

        const SHOP = [
            { id: 'gears', name: 'RUSTY GEARS', desc: '+0.5 sec/s', cost: 1, power: 0.5 },
            { id: 'chrono', name: 'DIGITAL WATCH', desc: '+2.0 sec/s', cost: 10, power: 2.0 },
            { id: 'machine', name: 'FLUX CAPACITOR', desc: '+10.0 sec/s', cost: 50, power: 10.0 }
        ];

        // Currency: 'c' = clocks, 'k' = chronotons
        const DISTRACTIONS = [
            { id: 'bg', name: 'COLOR_SHIFT', desc: 'Change Bg', cost: 1, curr: 'c', action: () => changeBg() },
            { id: 'rock', name: 'PET_ROCK', desc: 'Feed Clocks', cost: 10, curr: 'c', action: () => renderRock() },
            { id: 'dvd', name: 'DVD_SCREEN', desc: 'Bouncing Logo', cost: 15, curr: 'c', action: () => toggleDVD() },
            { id: 'chat', name: 'LIVESTREAM', desc: 'Read Spam', cost: 25, curr: 'c', action: () => renderChat() },
            { id: 'bubble', name: 'BUBBLE WRAP', desc: 'Pop pop pop', cost: 50, curr: 'c', action: () => renderBubble() },
            { id: 'draw', name: 'DRAWING PAD', desc: 'Useless Art', cost: 1, curr: 'k', action: () => renderDraw() }
        ];

        // --- DOM ---
        const els = {
            sec: document.getElementById('secondsDisplay'),
            clk: document.getElementById('clocksDisplay'),
            rate: document.getElementById('rateDisplay'),
            btnConv: document.getElementById('convertBtn'),
            costConv: document.getElementById('convertCost'),
            msgConv: document.getElementById('convertMsg'),
            shop: document.getElementById('shopGrid'),
            dist: document.getElementById('distractionGrid'),
            deskLeft: document.getElementById('desktopSidebarLeft'),
            deskRight: document.getElementById('desktopSidebarRight'),
            log: document.getElementById('gameLog'),
            zone: document.getElementById('boredomSection'),
            mini: document.getElementById('activeMinigame'),
            cvs: document.getElementById('boredomCanvas'),
            prestige: document.getElementById('prestigeSection'),
            chrono: document.getElementById('chronotonDisplay'),
            chronoCol: document.getElementById('chronoColumn'),
            chronoSpc: document.getElementById('chronoSpacer'),
            chronoMult: document.getElementById('chronoMultDisplay'),
            potChrono: document.getElementById('potentialChrono'),
            offline: document.getElementById('offlineBadge'),
            chronoTotal: document.getElementById('chronoTotalDisplay'),
            runTotal: document.getElementById('runTotalDisplay')
        };

        // --- Loop ---
        let lastTime = Date.now();
        let saveTimer = 0;
        let goldenTimer = 0;

        function gameLoop() {
            const now = Date.now();
            const dt = (now - lastTime) / 1000;
            lastTime = now;

            // Calc Rate
            let baseRate = 1;
            SHOP.forEach(item => {
                baseRate += (state.shopCounts[item.id] || 0) * item.power;
            });
            
            // Apply Multipliers
            const prestigeMult = 1 + (state.chronotons * 100); 
            const realWorldMult = getRealWorldMult();
            const finalRate = baseRate * prestigeMult * realWorldMult;

            const gain = finalRate * dt;

            // Add Time
            state.seconds += gain;
            state.totalSecondsWasted += gain;
            state.runSecondsWasted += gain;

            // Updates
            updateUI(finalRate, prestigeMult);
            
            // Autosave (10s)
            saveTimer += dt;
            if (saveTimer > 10) {
                saveGame();
                saveTimer = 0;
            }

            // Golden Seconds
            goldenTimer += dt;
            if (goldenTimer > 1) { 
                if (Math.random() < 0.02) spawnGoldenSecond(); 
                goldenTimer = 0;
            }

            requestAnimationFrame(gameLoop);
        }

        // --- Logic ---

        function getRealWorldMult() {
            const h = new Date().getHours();
            if (h >= 1 && h < 4) return 2.0; // Night
            return 1.0;
        }

        function getConversionCost() {
            return Math.floor(CONFIG.BASE_CONVERSION * Math.pow(CONFIG.CONVERSION_SCALE, state.conversions));
        }

        function getNextChronoCost() {
            return CONFIG.CHRONO_THRESHOLD * Math.pow(CONFIG.CHRONO_SCALE, state.chronotons);
        }

        function updateUI(rate, pMult) {
            els.sec.innerText = state.seconds.toFixed(1);
            els.clk.innerText = state.clocks;
            els.rate.innerText = `+${rate.toFixed(1)}/s`;
            
            els.chronoTotal.innerText = state.totalSecondsWasted.toFixed(1);
            els.runTotal.innerText = state.runSecondsWasted.toFixed(1);

            els.chrono.innerText = state.chronotons;
            els.chronoMult.innerText = `+${Math.round((pMult - 1) * 100)}% BONUS`;

            // Chronoton Visibility
            if (state.prestigeCount > 0) {
                els.chronoCol.classList.remove('hidden');
                els.chronoSpc.classList.add('hidden');
            } else {
                els.chronoCol.classList.add('hidden');
                els.chronoSpc.classList.remove('hidden');
            }

            // Titles
            const rank = RANKS.findLast(r => state.totalSecondsWasted >= r.t) || RANKS[0];
            document.getElementById('rankTitle').innerText = `RANK: ${rank.title}`;

            // Convert Button
            const cost = getConversionCost();
            els.costConv.innerText = cost;
            els.btnConv.disabled = state.seconds < cost;

            // Unlock Shop & Zones
            if (state.clocks > 0 || state.totalSecondsWasted > 50) {
                els.zone.classList.remove('opacity-50', 'pointer-events-none');
                els.deskLeft.classList.remove('opacity-50', 'pointer-events-none');
                els.deskRight.classList.remove('opacity-50', 'pointer-events-none');
            }

            // Prestige Availability
            const nextCost = getNextChronoCost();
            const canPrestige = state.totalSecondsWasted >= nextCost;
            
            // Update Requirement Text
            const reqDisplay = document.getElementById('nextChronoReq');
            if(reqDisplay) reqDisplay.innerText = nextCost.toLocaleString();

            if (canPrestige) {
                els.prestige.classList.remove('hidden');
                els.potChrono.innerText = `REWARD: 1 CHRONOTON`;
            } else {
                els.prestige.classList.add('hidden');
            }

            // Shop Buttons
            SHOP.forEach(item => {
                const btn = document.getElementById(`btn-${item.id}`);
                if (btn) {
                    // ADDITIVE COST LOGIC: Price = Base + (Count * Base)
                    const count = state.shopCounts[item.id] || 0;
                    const price = item.cost + (count * item.cost);
                    
                    btn.disabled = state.clocks < price;
                    btn.querySelector('.price').innerText = price;
                }
            });
            
            // Distraction Buttons availability (visual only) - Updates both Mobile and Desktop versions
            DISTRACTIONS.forEach(d => {
                if (!state.unlocks[d.id]) {
                    ['mob', 'desk'].forEach(suffix => {
                        const btn = document.getElementById(`dist-btn-${d.id}-${suffix}`);
                        if (btn) {
                            const canAfford = d.curr === 'k' ? state.chronotons >= d.cost : state.clocks >= d.cost;
                            btn.style.borderColor = canAfford ? '#ffffff' : '#555555';
                            btn.style.color = canAfford ? '#ffffff' : '#555555';
                        }
                    });
                }
            });
        }

        // --- Actions ---

        window.convert = function() {
            const cost = getConversionCost();
            if (state.seconds >= cost) {
                state.seconds -= cost;
                state.clocks++;
                state.conversions++;
                log(`CONVERTED. RATE INCREASED. NEW COST: ${getConversionCost()}`);
                renderShop();
                renderDistractions();
            } else {
                els.msgConv.style.opacity = 1;
                setTimeout(() => els.msgConv.style.opacity = 0, 1000);
            }
        };
        els.btnConv.onclick = window.convert;

        window.buy = function(id) {
            const item = SHOP.find(i => i.id === id);
            const count = state.shopCounts[id] || 0;
            
            // ADDITIVE COST LOGIC: Price = Base + (Count * Base)
            const price = item.cost + (count * item.cost);

            if (state.clocks >= price) {
                state.clocks -= price;
                state.shopCounts[id] = count + 1;
                log(`BOUGHT ${item.name}`);
                saveGame();
                renderShop();
            }
        };

        window.buyDist = function(id) {
            const d = DISTRACTIONS.find(x => x.id === id);
            if (!state.unlocks[id]) {
                // Buying Logic
                if (d.curr === 'k') {
                    // Chronoton cost
                    if (state.chronotons >= d.cost) {
                        state.chronotons -= d.cost;
                        state.unlocks[id] = true;
                        log(`UNLOCKED ${d.name}`);
                        saveGame();
                        renderDistractions();
                    } else {
                        log("NOT ENOUGH CHRONOTONS");
                    }
                } else {
                    // Clock cost
                    if (state.clocks >= d.cost) {
                        state.clocks -= d.cost;
                        state.unlocks[id] = true;
                        log(`UNLOCKED ${d.name}`);
                        saveGame();
                        renderDistractions();
                    } else {
                        log("NOT ENOUGH CLOCKS");
                    }
                }
            } else {
                // Launch Logic
                d.action();
            }
        };

        window.triggerReset = function() {
            if (confirm("HARD RESET: DELETE ALL DATA?")) {
                if (confirm("ARE YOU ABSOLUTELY SURE? THIS CANNOT BE UNDONE.")) {
                    localStorage.removeItem(CONFIG.SAVE_KEY);
                    location.reload();
                }
            }
        };

        window.prestige = function() {
            const cost = getNextChronoCost();
            
            if (state.totalSecondsWasted < cost) {
                alert("YOU NEED MORE LIFETIME SECONDS TO GAIN A CHRONOTON.");
                return;
            }

            if (!confirm(`RESET RUN? YOU WILL GAIN 1 CHRONOTON.`)) return;
            
            state.chronotons += 1;
            state.prestigeCount++;
            state.seconds = 0;
            state.runSecondsWasted = 0; 
            state.clocks = 0;
            state.conversions = 0;
            state.shopCounts = { gears: 0, chrono: 0, machine: 0 };
            
            log(`PRESTIGE COMPLETE. +1 CHRONOTON.`);
            saveGame();
            renderShop();
            renderDistractions();
        };

        // --- Minigame Features ---

        function spawnGoldenSecond() {
            const el = document.createElement('div');
            el.innerText = "+60s";
            el.className = "golden-second";
            el.style.left = Math.random() * 80 + 10 + "%";
            
            el.onclick = () => {
                el.classList.add('captured');
                el.innerText = "CAPTURED!";
                state.seconds += 60;
                state.totalSecondsWasted += 60;
                state.runSecondsWasted += 60;
                log("CAPTURED GOLDEN SECOND (+60s)");
                setTimeout(() => el.remove(), 500);
            };
            
            document.body.appendChild(el);
            setTimeout(() => {
                if(el.parentNode && !el.classList.contains('captured')) el.remove();
            }, 4000);
        }

        // --- Boredom Zone Renderers ---

        function renderChat() {
            const NAMES = ["Streamer69", "Bot_1", "Mod_Dave", "User99", "Troll", "Fan1", "Leeroy_Jenkins", "PogChamp_2026", "KeyboardCat_Legacy", "Lag_Switch_Larry", "DoubleRainbow", "Sub_Goal_Hero", "Nyan_Knight", "Mod_Me_Pls", "Numa_Numa_Guy", "StreamSniper", "AFK_Forever", "ChocolateRain", "Bit_Farmer", "EarlyAdopter", "AllYourBase", "Buffering...", "ClickBait_King", "Pepe_The_Great", "Raid_Leader", "DancingBaby96", "HampsterDance", "LURKER_MODE", "TrollFace_OG", "Badge_Hunter", "Vibe_Curator", "Gamer_Fuel", "DialUp_Ghost", "Donation_Goal", "Kappa_Clap", "Alt_F4_Expert", "Doge_Father", "Main_Character", "Checkmark_Chaser", "Grimes_Fan_2077", "Rick_Roller", "Harambe_Lives", "Speedrunner_64", "NoScope_Nate", "Hydrated_Gamer", "Backseat_Gaming", "Emote_Spammer", "CottageCore_Code", "Zalgo_Text", "Lofi_Listener", "Cloud_Chaser", "Error_404_Found", "Script_Kiddie", "Giga_Chad", "Simp_City", "Ratio_King", "UwU_Enthusiast", "Mainframe_Max", "Botnet_Beta", "Spam_Filter", "Zero_Day_Zack", "Kernel_Panic", "Packet_Loss", "Ping_King", "Data_Miner", "Cache_Money", "Binary_Bard", "Cyber_Punk", "Synth_Wave", "Neon_Noir", "Meta_Verse", "Crypto_Crasher", "BlockChain_Billy", "NFT_Nightmare", "Web_Crawler", "Deep_Web_Dan", "Matrix_Glitch", "Loading_Screen", "Final_Boss", "Respawn_Point", "Health_Potion", "Mana_Burn", "Quest_Giver", "NPC_Energy", "Main_Quest", "Side_Hustle", "Skill_Issue", "Git_Gud", "Noob_Tuber", "Spawn_Camper", "Headshot_Harry", "Frag_Master", "Kill_Streak", "Game_Over", "Level_Up", "Experience_Point", "Stat_Maxer", "Speed_Run", "Tool_Assisted", "Glitch_Hunter", "Sequence_Break", "Wall_Hack", "Aim_Bot", "Recoil_Control", "Burst_Fire"];
            const MSGS = ["POG", "LUL", "Skip", "Is this live?", "Notice me @BeepSmol", "F", "Lag", "Play Minecraft", "Subscribe to @BeepSmol on Youtube!", "W", "L", "KEKW", "OMEGALUL", "MonkaS", "Clap", "GG", "Raid @BeepSmol", "Check your Discord @BeepSmol", "Is it laggy?", "Turn up the mic", "What game is this?", "MODS??", "Ban him", "Can I be mod?", "HYPE", "PauseChamp", "Sadge", "WidePeepoHappy", "Where is the facecam?", "Do a flip @BeepSmol", "Go to bed", "I was here", "First!", "Bruh", "Ratio", "Cringe", "Based", "Is this a speedrun?", "He‚Äôs throwing", "Throwing for content", "COPIUM", "Rigged", "Scammed", "BELIEVERS RISE UP", "DOUBTERS?", "Rip headphone users", "Volume up", "I can't hear the game", "Music name?", "Song ID?", "What‚Äôs the playlist?", "Shots fired", "Hydrate!", "Water check", "Posture check @BeepSmol", "Don't go in there", "Look behind you", "You missed a chest", "Reading is hard", "Streamer is blind", "10/10", "Zero deaths", "Poggers", "Everyone follow @BeepSmol", "Check out @BeepSmol on YouTube!", "@BeepSmol shout out please", "Happy Birthday @BeepSmol!", "How long have you been live?", "What's your setup?", "Specs?", "Keyboard sounds ASMR", "Mouse cam?", "Hand cam?", "Green screen glitching", "Cat reveal?", "Show the dog", "Pet the cat", "Kappa", "ResidentSleeper", "NotLikeThis", "BibleThump", "PogChamp", "TriHard", "MingLee", "Kreygasm", "CoolStoryBob", "HeyGuys", "VoHiYo", "KonCha", "Can we get a W in chat?", "L chat", "Big brain move", "Smooth brain", "Clutch", "Choke", "Wait what?", "No way", "CLIP IT", "Clip that", "I missed it", "What happened?", "Just tuned in", "Welcome back", "Thanks for the stream @BeepSmol", "See you tomorrow"];
            
            els.mini.innerHTML = `
                <div class="p-2 h-40 flex flex-col">
                    <div class="border-b border-white mb-2 font-bold flex justify-between">
                        <span>LIVESTREAM_CHAT</span>
                        <span class="text-red-500 text-[10px] animate-pulse">‚óè LIVE</span>
                    </div>
                    <div id="chatBox" class="flex-1 overflow-y-auto text-xs space-y-1 mb-2 bg-gray-900 p-1"></div>
                    <button onclick="document.getElementById('activeMinigame').innerHTML=''" class="text-xs border border-white p-1">LEAVE STREAM</button>
                </div>
            `;
            
            const box = document.getElementById('chatBox');
            
            const addMsg = () => {
                if (!document.getElementById('chatBox')) return;
                const name = NAMES[Math.floor(Math.random() * NAMES.length)];
                const msg = MSGS[Math.floor(Math.random() * MSGS.length)];
                const color = `hsl(${Math.random()*360}, 70%, 70%)`;
                box.innerHTML += `<div class="break-words"><span style="color:${color}">${name}:</span> ${msg}</div>`;
                box.scrollTop = box.scrollHeight;
                if(box.children.length > 20) box.firstChild.remove();
                setTimeout(addMsg, Math.random() * 1000 + 500);
            };
            addMsg();
        }

        function renderRock() {
            els.mini.innerHTML = `
                <div class="p-4 text-center">
                    <div class="text-4xl mb-2">ü™®</div>
                    <div class="text-xs my-2">THE ROCK STARES INTO YOUR SOUL.</div>
                    <button onclick="feedRock()" class="btn text-xs mb-2">FEED (1 CLOCK)</button>
                    <button onclick="document.getElementById('activeMinigame').innerHTML=''" class="btn text-xs border-red-500 text-red-500">LEAVE</button>
                </div>
            `;
        }

        window.feedRock = function() {
            if (state.clocks >= 1) {
                state.clocks--;
                log("YOU FED THE ROCK. IT IS NOT IMPRESSED.");
            } else {
                log("YOU CANNOT AFFORD TO FEED THE ROCK.");
            }
        }

        function renderBubble() {
            els.mini.innerHTML = `
                <div class="p-2">
                    <div class="text-center font-bold mb-2">BUBBLE WRAP</div>
                    <div id="bubbleGrid" class="grid grid-cols-8 gap-2 justify-center bg-gray-900 p-2"></div>
                    <button onclick="renderBubble()" class="btn w-full mt-2 text-xs">RESET WRAP</button>
                    <button onclick="document.getElementById('activeMinigame').innerHTML=''" class="btn w-full mt-2 text-xs border-red-500 text-red-500">CLOSE</button>
                </div>
            `;
            const grid = document.getElementById('bubbleGrid');
            for(let i=0; i<24; i++) {
                const b = document.createElement('div');
                b.className = 'bubble';
                b.onclick = function() {
                    if(!this.classList.contains('popped')) {
                        this.classList.add('popped');
                        // Simulated pop sound effect via log
                        // log("POP");
                    }
                }
                grid.appendChild(b);
            }
        }

        function renderDraw() {
            els.mini.innerHTML = `
                <div class="p-2 flex flex-col items-center">
                    <div class="font-bold mb-2">DRAWING PAD</div>
                    <canvas id="drawCanvas" width="250" height="200"></canvas>
                    <div class="flex gap-2 mt-2 w-full">
                        <button onclick="clearDraw()" class="btn flex-1 text-xs">CLEAR</button>
                        <button onclick="document.getElementById('activeMinigame').innerHTML=''" class="btn flex-1 text-xs border-red-500 text-red-500">CLOSE</button>
                    </div>
                </div>
            `;
            initDraw();
        }

        function initDraw() {
            const c = document.getElementById('drawCanvas');
            const ctx = c.getContext('2d');
            let painting = false;

            function start(e) { painting = true; draw(e); }
            function end() { painting = false; ctx.beginPath(); }
            function draw(e) {
                if (!painting) return;
                const rect = c.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#fff';
                
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }

            c.onmousedown = start;
            c.onmouseup = end;
            c.onmousemove = draw;
            
            c.ontouchstart = (e) => { e.preventDefault(); start(e); };
            c.ontouchend = (e) => { e.preventDefault(); end(e); };
            c.ontouchmove = (e) => { e.preventDefault(); draw(e); };
        }

        window.clearDraw = function() {
            const c = document.getElementById('drawCanvas');
            const ctx = c.getContext('2d');
            ctx.clearRect(0,0,c.width, c.height);
        }

        // --- Main Renderers ---

        function renderShop() {
            els.shop.innerHTML = '';
            SHOP.forEach(item => {
                const count = state.shopCounts[item.id] || 0;
                // ADDITIVE COST LOGIC
                const cost = item.cost + (count * item.cost);
                
                const div = document.createElement('div');
                div.className = "box flex justify-between items-center p-2 mb-0";
                div.innerHTML = `
                    <div class="text-xs">
                        <div class="font-bold text-yellow-200">${item.name}</div>
                        <div class="text-gray-400 text-[10px]">${item.desc}</div>
                        <div>OWNED: ${count}</div>
                    </div>
                    <button id="btn-${item.id}" onclick="buy('${item.id}')" class="btn text-xs text-right">
                        BUY <br>(<span class="price">${cost}</span>)
                    </button>
                `;
                els.shop.appendChild(div);
            });
        }

        // --- Distraction Card Generator (Shared) ---
        function createDistCard(d, suffix) {
            const unlocked = state.unlocks[d.id];
            const div = document.createElement('div');
            // Dynamic border based on state
            let borderClass = 'border-gray-600 text-gray-600';
            if(unlocked) borderClass = 'border-blue-400 text-blue-400';
            
            div.className = `box flex flex-col items-center justify-center p-2 text-center ${borderClass} transition-all`;
            div.id = `dist-btn-${d.id}-${suffix}`;
            
            const costLabel = d.curr === 'k' ? `${d.cost} CHRONO` : `${d.cost} CLOCKS`;
            const costColor = d.curr === 'k' ? 'text-purple-400' : 'text-yellow-200';

            if (unlocked) {
                div.innerHTML = `
                    <div class="font-bold text-xs">${d.name}</div>
                    <div class="text-[10px] italic mb-1">${d.desc}</div>
                    <div class="text-[10px] font-bold border border-current px-2 py-1 hover:bg-white hover:text-black cursor-pointer w-full">LAUNCH</div>`;
                div.onclick = () => d.action();
            } else {
                div.innerHTML = `
                    <div class="font-bold text-xs">LOCKED</div>
                    <div class="text-[10px] italic mb-1">${d.name}</div>
                    <div class="text-[10px] font-bold border border-gray-600 px-2 py-1 w-full ${costColor}">
                        [BUY: ${costLabel}]
                    </div>`;
                div.onclick = () => buyDist(d.id);
            }
            return div;
        }

        function renderDistractions() {
            // Clear all containers
            els.dist.innerHTML = '';
            els.deskLeft.querySelectorAll('div:not(:first-child)').forEach(el => el.remove()); // Keep title
            els.deskRight.querySelectorAll('div:not(:first-child)').forEach(el => el.remove()); // Keep title

            DISTRACTIONS.forEach((d, index) => {
                // 1. Mobile Render (Grid)
                const mobEl = createDistCard(d, 'mob');
                els.dist.appendChild(mobEl);

                // 2. Desktop Render (Sidebars)
                const deskEl = createDistCard(d, 'desk');
                // Even items go Left, Odd items go Right
                if (index % 2 === 0) {
                    els.deskLeft.appendChild(deskEl);
                } else {
                    els.deskRight.appendChild(deskEl);
                }
            });
        }

        function changeBg() {
            document.body.style.backgroundColor = `hsl(${Math.random()*360}, 50%, 5%)`;
        }

        function log(msg) {
            const d = document.createElement('div');
            d.innerText = `> ${msg}`;
            els.log.insertBefore(d, els.log.firstChild);
            if (els.log.children.length > 20) els.log.lastChild.remove();
        }

        // --- Save/Load & Offline Progress ---

        function saveGame() {
            state.lastSaveTime = Date.now();
            localStorage.setItem(CONFIG.SAVE_KEY, JSON.stringify(state));
        }

        function loadGame() {
            const raw = localStorage.getItem(CONFIG.SAVE_KEY);
            if (raw) {
                try {
                    const saved = JSON.parse(raw);
                    state = { ...state, ...saved };
                    
                    // Offline Calculation
                    const now = Date.now();
                    const diffMs = now - (state.lastSaveTime || now);
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    if (diffMins > 0) {
                        const totalUpgrades = Object.values(state.shopCounts).reduce((a,b)=>a+b,0);
                        const ratePerMin = CONFIG.OFFLINE_RATE + (totalUpgrades * 0.5);
                        const gain = Math.floor(diffMins * ratePerMin);
                        
                        state.seconds += gain;
                        state.totalSecondsWasted += gain;
                        if(typeof state.runSecondsWasted === 'undefined') state.runSecondsWasted = 0;
                        state.runSecondsWasted += gain;
                        
                        els.offline.classList.remove('hidden');
                        document.getElementById('offlineGain').innerText = gain;
                        log(`OFFLINE FOR ${diffMins} MINS. GAINED ${gain}s.`);
                    }
                } catch(e) {
                    console.error("Save Error", e);
                }
            }
            
            // Fix new fields if missing
            if(typeof state.prestigeCount === 'undefined') state.prestigeCount = 0;
            // Backwards compatibility for unlocks
            if(!state.unlocks.bubble) state.unlocks.bubble = false;
            if(!state.unlocks.draw) state.unlocks.draw = false;
            
            renderShop();
            renderDistractions();
        }

        // --- Visuals (Canvas) ---
        function toggleDVD() {
            const cvs = els.cvs;
            if (getComputedStyle(cvs).opacity === '0') {
                cvs.style.opacity = 0.5;
                cvs.width = window.innerWidth;
                cvs.height = window.innerHeight;
                requestAnimationFrame(animateDVD);
            } else {
                cvs.style.opacity = 0;
            }
        }

        let dvd = { x: 50, y: 50, dx: 3, dy: 3, w: 100, h: 50 };
        function animateDVD() {
            if (getComputedStyle(els.cvs).opacity === '0') return;
            const ctx = els.cvs.getContext('2d');
            ctx.clearRect(0, 0, els.cvs.width, els.cvs.height);
            
            dvd.x += dvd.dx;
            dvd.y += dvd.dy;

            if (dvd.x + dvd.w > els.cvs.width || dvd.x < 0) dvd.dx *= -1;
            if (dvd.y + dvd.h > els.cvs.height || dvd.y < 0) dvd.dy *= -1;

            if (assets.dvd.complete && assets.dvd.naturalHeight > 0) {
                ctx.drawImage(assets.dvd, dvd.x, dvd.y, dvd.w, dvd.h);
            } else {
                ctx.strokeStyle = 'white';
                ctx.strokeRect(dvd.x, dvd.y, dvd.w, dvd.h);
                ctx.fillStyle = 'white';
                ctx.fillText("DVD", dvd.x + 40, dvd.y + 30);
            }
            requestAnimationFrame(animateDVD);
        }

        function toggleMusic() {
            if (assets.music.paused) assets.music.play();
            else assets.music.pause();
        }

        window.onload = function() {
            loadGame();

            document.getElementById('startOverlay').onclick = function() {
            assets.music.play(); // Music starts here
            this.remove();       // Remove the overlay
            requestAnimationFrame(gameLoop);
          };
            
            window.onresize = () => {
                els.cvs.width = window.innerWidth;
                els.cvs.height = window.innerHeight;
            };
        };

    </script>
</body>

</html>
